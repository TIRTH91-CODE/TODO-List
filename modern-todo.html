<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modern Toâ€‘Do â€” Single File</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f1724; /* deep navy */
      --card:#0b1220;
      --muted:#98a0b3;
      --accent:#7c5cff;
      --accent-2:#4dd0e1;
      --glass: rgba(255,255,255,0.04);
      --success: #2dd4bf;
      --danger: #ff6b6b;
      --radius: 14px;
      --shadow: 0 8px 30px rgba(2,6,23,0.6);
      font-family: 'Inter',system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(800px 400px at 10% 10%, rgba(124,92,255,0.12), transparent),
                  radial-gradient(600px 300px at 90% 90%, rgba(77,208,225,0.06), transparent),
                  var(--bg);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:40px 24px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:20px;
      font-size:16px;
    }
    .app{
      width:100%;
      max-width:920px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border-radius:calc(var(--radius));
      padding:28px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px) saturate(120%);
      border:1px solid rgba(255,255,255,0.03);
    }
    header{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;gap:12px
    }
    .title{
      display:flex;gap:12px;align-items:center
    }
    .logo{
      height:56px;width:56px;border-radius:12px;display:grid;place-items:center;background:linear-gradient(135deg,var(--accent),var(--accent-2));font-weight:700;color:white;font-size:22px;box-shadow:0 6px 18px rgba(124,92,255,0.18);
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{
      background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer;font-weight:600;font-size:13px
    }
    .btn.ghost{background:transparent}
    .input-row{display:flex;gap:12px;margin-bottom:18px}
    input.new-task{
      flex:1;padding:14px 16px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);color:inherit;font-size:15px;outline:none
    }
    input.new-task::placeholder{color:rgba(230,238,248,0.45)}
    .add-btn{padding:12px 16px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:#082032;font-weight:700;cursor:pointer}
    .board{display:flex;gap:20px}
    .list{
      flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.012), transparent);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);min-height:260px;max-height:520px;overflow:auto
    }
    .filters{display:flex;gap:8px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);align-items:center}
    .filters button{padding:8px 10px;border-radius:8px;border:none;background:transparent;color:var(--muted);cursor:pointer}
    .filters button.active{color:var(--accent);font-weight:700}
    .task{
      display:flex;gap:12px;align-items:center;padding:10px;border-radius:10px;margin-bottom:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);
    }
    .task.dragging{opacity:0.6;transform:scale(0.995)}
    .task .check{width:20px;height:20px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);display:grid;place-items:center;cursor:pointer}
    .task.completed .check{background:linear-gradient(90deg,var(--success),#16a085);border:none;color:#022;}
    .task .title{flex:1;min-width:0}
    .task .title input{width:100%;background:transparent;border:none;color:inherit;outline:none;font-size:15px}
    .meta{display:flex;gap:8px;align-items:center}
    .icon-btn{background:transparent;border:none;color:var(--muted);cursor:pointer;padding:6px;border-radius:8px}
    .small{font-size:13px;color:var(--muted)}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
    .hint{color:var(--muted);font-size:13px}
    @media (max-width:820px){
      .board{flex-direction:column}
      body{padding:20px}
    }
  </style>
</head>
<body>
  <main class="app" role="application" aria-label="Toâ€‘Do app">
    <header>
      <div class="title">
        <div class="logo">TD</div>
        <div>
          <h1>Modern Toâ€‘Do</h1>
          <p class="lead">Lightweight, keyboard friendly, saves in your browser</p>
        </div>
      </div>
      <div class="controls">
        <div class="small">Theme</div>
        <button id="export" class="btn">Export</button>
        <button id="importBtn" class="btn ghost">Import</button>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
    </header>

    <section class="input-row" aria-label="Add new task">
      <input id="newTask" class="new-task" placeholder="What do you want to do today? (press Enter to add)" aria-label="New task" />
      <button id="addBtn" class="add-btn">Add</button>
    </section>

    <div class="board">
      <section class="list" aria-label="Tasks list">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Tasks</strong>
          <div class="filters" role="toolbar" aria-label="Filters">
            <button data-filter="all" class="active">All</button>
            <button data-filter="active">Active</button>
            <button data-filter="completed">Completed</button>
          </div>
        </div>
        <div id="taskList" aria-live="polite"></div>
        <footer>
          <div class="hint" id="count">0 items</div>
          <div style="display:flex;gap:8px">
            <button id="clearCompleted" class="btn ghost">Clear completed</button>
            <button id="reset" class="btn ghost">Reset</button>
          </div>
        </footer>
      </section>
    </div>
  </main>

  <script>
    /* Modern single-file to-do app
       Features:
         - add / edit / complete / delete
         - drag and drop reorder (HTML5)
         - filters: all, active, completed
         - save to localStorage + export/import JSON
         - accessible keyboard shortcuts
    */

    const newTaskEl = document.getElementById('newTask');
    const addBtn = document.getElementById('addBtn');
    const taskList = document.getElementById('taskList');
    const countEl = document.getElementById('count');
    const filters = document.querySelectorAll('.filters button');
    const clearCompletedBtn = document.getElementById('clearCompleted');
    const resetBtn = document.getElementById('reset');
    const exportBtn = document.getElementById('export');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');

    let state = {
      tasks: [],
      filter: 'all'
    };

    const STORAGE_KEY = 'modern_todo_v1';

    // Utilities
    const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,7);

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }
    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) state = JSON.parse(raw);
      }catch(e){console.error(e)}
    }

    function render(){
      taskList.innerHTML = '';
      const tasks = state.tasks;
      const filtered = tasks.filter(t => {
        if(state.filter === 'active') return !t.done;
        if(state.filter === 'completed') return t.done;
        return true;
      });

      filtered.forEach(task => taskList.appendChild(createTaskNode(task)));
      countEl.textContent = `${state.tasks.filter(t => !t.done).length} item(s) left`;
    }

    function createTaskNode(task){
      const row = document.createElement('div');
      row.className = 'task' + (task.done ? ' completed' : '');
      row.setAttribute('draggable', 'true');
      row.dataset.id = task.id;

      // drag handlers for visual feedback
      row.addEventListener('dragstart', e=>{
        row.classList.add('dragging');
        e.dataTransfer.setData('text/plain', task.id);
        e.dataTransfer.effectAllowed = 'move';
      });
      row.addEventListener('dragend', ()=>row.classList.remove('dragging'));

      // dropzone behavior on list
      row.addEventListener('dragover', e=>{
        e.preventDefault();
        const dragging = document.querySelector('.task.dragging');
        if(!dragging || dragging === row) return;
        const rect = row.getBoundingClientRect();
        const after = (e.clientY - rect.top) > rect.height/2;
        const parent = row.parentNode;
        parent.insertBefore(dragging, after ? row.nextSibling : row);
      });

      const check = document.createElement('button');
      check.className = 'check';
      check.setAttribute('aria-label', task.done ? 'Mark as not done' : 'Mark as done');
      check.innerHTML = task.done ? 'âœ“' : '';
      check.addEventListener('click', ()=>toggleDone(task.id));

      const title = document.createElement('div');
      title.className = 'title';
      const inp = document.createElement('input');
      inp.type = 'text'; inp.value = task.text;
      inp.title = 'Edit task';

      inp.addEventListener('change', ()=>updateText(task.id, inp.value));
      inp.addEventListener('keydown', e=>{
        if(e.key === 'Escape') inp.blur();
        if(e.key === 'Enter') inp.blur();
      });

      title.appendChild(inp);

      const meta = document.createElement('div');
      meta.className = 'meta';

      const date = document.createElement('div');
      date.className = 'small';
      date.textContent = new Date(task.created).toLocaleString();

      const del = document.createElement('button');
      del.className = 'icon-btn';
      del.setAttribute('aria-label','Delete task');
      del.innerHTML = 'ðŸ—‘';
      del.addEventListener('click', ()=>deleteTask(task.id));

      meta.appendChild(date);
      meta.appendChild(del);

      row.appendChild(check);
      row.appendChild(title);
      row.appendChild(meta);

      return row;
    }

    // state operations
    function addTask(text){
      if(!text || !text.trim()) return;
      const t = {id:uid(), text:text.trim(), done:false, created: Date.now()};
      state.tasks.push(t);
      save(); render();
    }
    function updateText(id, text){
      const t = state.tasks.find(x=>x.id===id);
      if(!t) return; t.text = text; save(); render();
    }
    function toggleDone(id){
      const t = state.tasks.find(x=>x.id===id);
      if(!t) return; t.done = !t.done; save(); render();
    }
    function deleteTask(id){
      state.tasks = state.tasks.filter(x=>x.id!==id); save(); render();
    }

    // re-order save after drag end
    taskList.addEventListener('drop', e=>{
      e.preventDefault();
      const draggedId = e.dataTransfer.getData('text/plain');
      const nodes = Array.from(taskList.children).filter(n => n.dataset.id);
      const newOrder = nodes.map(n => n.dataset.id);
      // reorder state.tasks to newOrder
      state.tasks = newOrder.map(id => state.tasks.find(t => t.id===id)).filter(Boolean);
      save(); render();
    });

    // filters
    filters.forEach(btn => btn.addEventListener('click', ()=>{
      filters.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      state.filter = btn.dataset.filter; render();
    }));

    clearCompletedBtn.addEventListener('click', ()=>{
      state.tasks = state.tasks.filter(t=>!t.done); save(); render();
    });

    resetBtn.addEventListener('click', ()=>{
      if(confirm('Reset and remove all tasks?')){ state.tasks = []; save(); render(); }
    });

    addBtn.addEventListener('click', ()=>{ addTask(newTaskEl.value); newTaskEl.value=''; newTaskEl.focus(); });
    newTaskEl.addEventListener('keydown', e=>{ if(e.key==='Enter'){ addTask(newTaskEl.value); newTaskEl.value=''; }});

    // Export / Import
    exportBtn.addEventListener('click', ()=>{
      const dataStr = JSON.stringify(state, null, 2);
      const blob = new Blob([dataStr], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `todo-export-${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', ()=>importFile.click());
    importFile.addEventListener('change', e=>{
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        try{
          const parsed = JSON.parse(ev.target.result);
          if(parsed && Array.isArray(parsed.tasks)){
            if(confirm('Replace current tasks with imported tasks?')){
              state = parsed; save(); render();
            }
          }else alert('Invalid file');
        }catch(err){alert('Could not parse JSON')}
      };
      reader.readAsText(file);
      importFile.value = '';
    });

    // initial load
    load(); render();

    // keyboard shortcuts
    window.addEventListener('keydown', e=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase()==='k'){
        e.preventDefault(); newTaskEl.focus(); newTaskEl.select();
      }
    });

    // small enhancement: save order when user stops dragging
    let dragTimer;
    document.addEventListener('dragover', ()=>{
      clearTimeout(dragTimer);
      dragTimer = setTimeout(()=>{
        // if user clicked reorder without drop, commit current visual order
        const nodes = Array.from(taskList.children).filter(n => n.dataset.id);
        const newOrder = nodes.map(n => n.dataset.id);
        state.tasks = newOrder.map(id => state.tasks.find(t => t.id===id)).filter(Boolean);
        save();
      }, 200);
    });
  </script>
</body>
</html>
